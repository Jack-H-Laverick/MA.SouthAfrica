---
title: "Southern Benguela"
subtitle: "StrathE2E2"
author: "Jack H Laverick<br> Benjamin Grier<br> Kelly Ortega Cisneros<br> Lynne Shannon<br> Douglas C Spiers<br> Michael R Heath"
date: "`r format(Sys.time(), '%d %b %Y')`"
output: 
  pagedreport::paged_hazelnuts:
    logo: "https://www.r-project.org/logo/Rlogo.svg"
    img_to_dark: TRUE
    logo_to_white: TRUE
    front_img: "img/Front.png"
    back_img: "img/Back.png"
    other_css: "tweaks.css"
knit: (function(inputFile, encoding) {
      pagedown::chrome_print(inputFile, 
                        encoding = encoding, 
                        timeout = 150)})
main-color: "#000000"
secondary-color: "#737372"
main-font: "Quicksand"
bibliography: "Impl_Strath_NorwSea.bib"
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left")
rm(list=ls())
library(tidyverse)
library(sf)
library(gt)
library(readxl)

pagebreak <- function() {
  if(knitr::is_latex_output())
    return("\\newpage")
  else
    return('<div style="page-break-before: always;" />')
}

source("../R scripts/@_Region file.R")
Period <- "2010-2019"

table_nums <- captioner::captioner(prefix = "Table ")

table.ref <- function(x) stringr::str_extract(table_nums(x), "[^:]*")

model <- StrathE2E2::e2e_read(implementation, Period, models.path="./Files") # Load implementation

Area <- read.csv(str_glue("Files/{implementation}/{Period}/Param/event_timing_{toupper(implementation)}_{Period}.csv")) %>% 
  filter(str_detect(Description, "km2")) %>% 
  .$Value                                                     # Get size of the model domain

```

# Introduction {.unnumbered}

This document describes the configuration of StrathE2E2 for the Southern Benguela Current System and its parameterisation to enable stationary state fitting for 2010-2070.
These represent contrasting periods of environmental conditions.

Volumetric and seabed habitat data define the physical configuration of the system.
We regard these as being fixed in time.
Similarly, we regard the physiological parameters of the ecology model as being fixed in time.
Some of these are set from external data.
The remainder are fitted, as detailed here.
Changes in the model performance between the different time periods therefore stem from the hydrodynamic, hydro-chemical and fishery driving data.
These are detailed in the ecological drivers and fishing fleet sections.

<br>

> Department of Mathematics and Statistics, University of Strathclyde, Glasgow, UK.
>
> E-mail: [m.heath\@strath.ac.uk](mailto:m.heath@strath.ac.uk){.email}
>
> The code written to support this parameterisation is available on [github](https://github.com/Jack-H-Laverick/MA.SouthAfrica).

<br>

> **WARNING**: This is a working document, subject to update and revision.

# Model Domain {.unnumbered}

The model splits the domain into three zones, inshore/shallow, offshore/shallow, and offshore/deep (Figure \@ref(fig:spatialschematic)).
The inshore/shallow zone covers waters shallower than `r SDepth` m .
The offshore zone covers the remaining area of the model domain (Figure \@ref(fig:habitats)).
The offshore zone is divided further into a shallow and deep layer.
The shallow layer represents water from the surface to `r SDepth` m depth, and shares a boundary with the inshore shallow zone.
The offshore/deep zone covers the same area as the offshore/shallow zone, but represents water between `r SDepth` m and `r DDepth` m deep.
There is a second internal boundary between the two offshore zones.

![(#fig:spatialschematic) The spatial structure of StrathE2E; Ocean volumes and seafloor habitats. StrathE2E is built around a simplified spatial structure which represents shelf seas. These spatial units are connected to each other and to boundaries as shown to the right. The volumes connected to each spatial component are highlighted in blue.](img/schematic%20overhang.svg)

\newpage

The seafloor of the model domain is represented by 5 habitat types.
There are three sediment classes for the inshore zone ‚Äì fine (muddy, 1), medium (sandy, 2) and coarse (gravel, 3).
The fourth class (rock, 0) represents an absence of soft sediment.
The rock class has different geochemical properties and supports the kelp forests in the model food web.

## Methodology
Sand, mud and gravel sediment areas were derived from Birch et al. (1986) sediment texture map of the South African coast. As the sediment map is in scanned-pdf format, this was digitised, and combined with rock habitat data from the South African National Biodiversity Institute (SANBI, 2018) using the following methods to create a single spatial dataset.

1. Map image georeferenced using thin-line-splice method (QGIS).
2. Colours corrected 'GNU Image Manipulation Program' to create areas of solid colour values and increase contrast between similar colours.
3. Corrected raster map image was polygonised (QGIS).
4. Categories of sediment were simplified to 'sand', 'mud' and 'gravel', and the polygons were cropped to the domain region.
5. SANBI National Biodiversity Assessment habitat classification polygons containing 'Substratum' variable with the name 'Rocky' were cropped to the domain region.
6. Rocky polygons were overlaid and merged to create a habitat map containing sand, mud, gravel and rock polygons for inshore and offshore zones respectively.

*The perimeter of the model domain is defined by a `r DDepth`m depth contour and the South African. Open ocean boundaries occur wherever there is no coastline. In consultation with local collaborators, we imposed additional boundaries to limit the extent of the domain between 14.45E and 22.5E, and 28.6S and 36.98S.*

![(#fig:habitats) Map of the Southern Benguela model domain. StrathE2E defines seabed sediment habitats as inshore (blues) or offshore (yellows). Within each zone, three sediment classes are represented ‚Äì fine (muddy, 1), medium (sandy, 2) and coarse (gravel, 3). A fourth class (rock, 0) represents an absence of soft sediment. Sedimentary data are derived from Birch et al. (1986), with the spatial extent of rock sediment derived from SANBI (2018) [-@laverick2022].](img/habitats.png)

# Fixed Physical {.unnumbered}

## Background {.unnumbered}

#### Water column inshore/shallow and offshore/deep zone area proportions and layer thicknesses; seabed habitat area proportions and sediment properties: {.unnumbered}

#### Parameters for relationship between median grain size, sediment porosity and permeability. Permeability is used as the basis for estimating hydraulic conductivity which is a parameter in the representation of sediment processes in the model: {.unnumbered}

Porosity (proportion by volume of interstitial water) and permeability of each sediment habitat were derived from median grain sizes using empirically-based relationships.

$$log_{10}(porosity) = p_3 + p_4\left(\frac{1}{1+e^{(\frac{-log_{10}(D_{50})-p_1}{p_2})}}\right)$$ D~50~ = median grain size (mm); parameters p~1~ = -1.227, p~2~ = -0.270, p~3~ = -0.436, p~4~ = 0.366 (Heath et al. 2015)

$$permeability = 10^{p_5}‚àôD_{50}^{*p_6}$$

where D~50~\* = 0.11 ‚â§ D~50~ ‚â§ 0.50 p~5~ = -9.213, p~6~ = 4.615 [@heath2015].

These relationships are coded into the StrathE2E2 R-package with the parameters in the csv setup file for the North Sea model.
The parameters are probably a reasonable starting point for any future model of a new region.
Derivation of the parameters is described in the following text sub-sections.

#### Parameters for in-built relationship between sediment mud content, and slowly degrading (refractory) organic nitrogen content of seabed sediments (see description in this document): {.unnumbered}

Values for each sediment type derived from parameterised relationships between total organic nitrogen content of sediments (TON%, percent by weight), mud content (mud%, percent by weight) and median grain size (D~50~, mm).

$$mud\% = 10^{p_7}‚àôùê∑_{50}^{ùëù_8}$$ p~7~ = 0.657, p~8~ = -0.800

$$TON\% = 10^{ùëù_9}‚àômud\%^{ùëù_{10}}$$

p~9~ = -1.965, p~10~ = 0.590

Proportion of TON estimated to be refractory = 0.9

These relationships are coded into the StrathE2E2 R-package with the parameters in the csv setup file for the North Sea model.
The relationships and parameters are probably a reasonable starting point for any future model of a new region, though there are clear regional variations.
Derivation of the parameters is described in the following sub-sections.

## Model area proportions {.unnumbered}

```{r area_proportions_cap}

tab_area_proportions_cap <- table_nums(name = "tab_area_proportions", 
    caption = stringr::str_glue("Area-proportions of the inshore and offshore zones and the thicknesses of the                                        water column layers. The sea surface area of the model domain is an estimated                                         {Area} km^2^."))
```

`r table_nums("tab_area_proportions")`

```{r area_proportions}

data_frame(Property = c("Sea-surface area proportion",
                        "Upper layer thickness (m)",
                        "Lower layer thickness (m)"),
           `Inshore/shallow` = c(model[["data"]][["physical.parameters"]][["x_shallowprop"]], 
                                 model[["data"]][["physical.parameters"]][["si_depth"]], 
                                 NA),
           `Offshore/deep` = c(1 - model[["data"]][["physical.parameters"]][["x_shallowprop"]], 
                               model[["data"]][["physical.parameters"]][["so_depth"]], 
                               model[["data"]][["physical.parameters"]][["d_depth"]])) %>% 
  gt() %>% 
  fmt_number(columns = c("Offshore/deep", "Inshore/shallow"), decimals = 4, use_seps = FALSE)


```

Sediment polygons containing sand, mud, gravel and rock classifications for the inshore and offshore domain regions (Figure \@ref(fig:habitats)).
The model area proportion was calculated as the proportion of the total domain area occupied by each habitat (e.g. 
proportion of domain area occupied by s0 inshore-rock habitat), with the sum of all habitat proportions equal to 1.
(`r table.ref("tab_habitat_proportions")`).
\newpage

```{r habitat_proportions_cap}
tab_habitat_proportions_cap <- table_nums(name = "tab_habitat_proportions", 
    caption = stringr::str_glue("Area proportions and other characteristics of the 8 seabed habitat classes defined in the model by depth, rock or sediment type. The sea surface area of the model domain is an estimated {Area} km^2^. Grain size is the median in mm, Permeability in units of m^2^, nitrogen content in %dw."))
```

`r table_nums("tab_habitat_proportions")`

```{r habitat_proportions}

physical <- read.csv(str_glue("Files/{implementation}/{Period}/Param/physical_parameters_{toupper(implementation)}.csv"))
  
proportions <- which(str_detect(physical$Description, "Area_proportion")& physical$Value != 0)
porosity <- which(str_detect(physical$Description, "Defined_porosity"))
permeability <- which(str_detect(physical$Description, "Defined_permeability"))
nitrogen <- which(str_detect(physical$Description, "Defined_total_N"))
grain <- which(str_detect(physical$Description, "grain_size"))

data_frame(Habitat = c("S0", "S1", "S2", "S3", "D0"),
           Depth = c("Shallow","Shallow","Shallow","Shallow", "Deep"),
           Zone = c("Inshore","Inshore","Inshore","Inshore", "Offshore"),
           Sediment = c("None (Rock)", "Fine", "Medium", "Coarse","None (Overhang)"),
           `Area Proportion` = physical$Value[proportions],
           `Grain size` = c(NA, physical$Value[grain[1:3]], NA),
           Porosity = c(NA, physical$Value[porosity[1:3]], NA),
           Permeability = c(NA, physical$Value[permeability[1:3]], NA),
           `Nitrogen content` = c(NA, physical$Value[nitrogen[1:3]], NA)) %>% 
  group_by(Zone, Depth) %>% 
  gt() %>% 
  fmt_number(columns = c("Area Proportion", "Grain size", "Porosity", "Permeability", "Nitrogen content"), 
                         decimals = 4, use_seps = FALSE) %>% 
  cols_align(align = 'center',
             columns = vars(`Area Proportion`, `Grain size`, Porosity, Permeability, `Nitrogen content`)) %>% 
  tab_options(row_group.background.color = "whitesmoke")


```

## Sediment porosity {.unnumbered}

Log-transformed porosity has been shown to have a sigmoidal relationship with log~10~(median grain size) (D~50~, mm) [@wilson18]:

$$log_{10}(porosity) = p_3 + p_4\left(\frac{1}{1+e^{(\frac{-log_{10}(D_{50})-p_1}{p_2})}}\right)$$

We use this relationship to calculate porosity for sea bed sediments in the Norwegian Sea (`r table.ref("tab_habitat_proportions")`), using an alternative parameterisation to Wilson [@pace21].
This alternative set of parameters extends the relationship to fine, muddy sediments (`r table.ref("tab_porosity")`).

```{r porosity_cap}

tab_porosity_cap <- table_nums(name = "tab_porosity", 
    caption = "The four parameters for the function relating sediment porosity to median grain size. From Pace et al. (in review)")
```

`r table_nums("tab_porosity")`

```{r tab_porosity}

d50_to_pore <- which(str_detect(physical$Description, "porosity_and_grainsize"))

data_frame(Parameter = paste0("P", 1:4),
           `Fitted value` = physical$Value[d50_to_pore]) %>%
  pivot_wider(names_from = Parameter, values_from = `Fitted value`) %>% 
  gt()

```

## Hydraulic conductivity {.unnumbered}

Hydraulic conductivity (H, m.s^-1^) represents the ease with which fluids flow through the particle grain matrix.
The related term ‚Äòpermeability‚Äô (m^-2^) is a measure of the connectedness of the fluid filled void spaces between the particle grains.
Permeability is a function only of the sediment matrix, whilst conductivity is a function of both the sediment and the permeating fluid, in particular the fluid viscosity and density.
Hydraulic conductivity is related to permeability by:

$$H = Permeability‚àôfluid\;density‚àô\frac{ùëî}{dynamic\;viscosity}$$

where: seawater density = 1027 kg.m^-3^ at salinity 35 and temperature 10¬∞C; seawater dynamic viscosity = 1.48 x 10^-3^ kg.m^-1^.s^-1^ at salinity 35 and temperature 10¬∞C; g = acceleration due to gravity = 9.8 m.s^-1^

Hence, $H = Permeability ¬∑ 6.8004¬∑10^6$ (m.s^-1^ at salinity 35 and temperature 10¬∞C)

Whole sediment permeability can be related to the proportion of sediment classed as mud (D~50~ \< 62 Œºm) [@pace21].
This relationship was used in the production of the Norwegian Basin model (`r table.ref("tab_habitat_proportions")`).

## Sediment organic nitrogen content {.unnumbered}

The magnitude of the static (refactory) organic nitrogen detritus pool in each sediment type is a required input to the model.
The code includes an option to impute values from empirical relationships between total organic nitrogen (TON) and mud content, and between mud content and median grain size.
This relationship has been documented in the North Sea implementation of the temperate StrathE2E2 package [@heath2021], and is based on sediment data off northeast Scotland.

# Fixed biological {.unnumbered}

## Configuration parameters {.unnumbered}

### Assimilation efficiencies for each living guild in the model. {.unnumbered}

Fixed parameters defining the proportion of ingested mass of food that contributes to new body tissue, after subtracting defecation and the metabolic costs of digestion and synthesis [@heath2012].

### Biomass loss rates due to temperature-dependent metabolism for each living resource guild. {.unnumbered}

Proportion of biomass lost to ammonia per day due to non-feeding related metabolism at a given reference temperature.
Rates for individual guilds broadly related to typical body mass of representative species.
Temperature dependency following a Q~10~ function.

### Q~10~ values for temperature dependent processes, and the Q~10~ reference temperature. {.unnumbered}

Separate Q10 values for autotrophic uptake of nutrient, heterotrophic feeding, and heterotrophic metabolism based on literature data.

### Light intensity required to saturate autotrophic nutrient uptake. {.unnumbered}

Light saturation intensity for nutrient uptake cannot be treated as a fitted value since it is confounded with other uptake parameters.
Value estimated from survey of laboratory experiments.

### Annual weight specific fecundities of planktivorous and demersal fish guilds and the two benthos guilds in the model (suspension/deposit feeders and carnivore/scavenge feeders). {.unnumbered}

Guild-level values derived by surveying the literature.

### Harvestable biomass density threshold for each resource guild. {.unnumbered}

The living resource guilds in the model represent a mixture of harvestable and non-harvestable species, especially the invertebrate guilds.
The density threshold parameter sets a limit for the guild biomass below which the harvestable species are assumed to be exhausted.
Values set from analysis of trawl, plankton and benthos survey species biomass compositions.

### Minimum inedible biomass of carnivorous zooplankton. {.unnumbered}

The carnivorous zooplankton guild is a key component of the food web, predated on by all the fish and top-predators.
However it represents an extremely diverse range of fauna many of which are not edible in significant quantities by the guild predators, e.g. scyphomedusae.
A minimum edible threshold is set to ensure that the guild as a whole cannot be extirpated by predation.
The value is a rough estimate of scyphomedusae biomass.

## Event timing parameters (not fitted) {.unnumbered}

Obtained from literature survey.


### Spawning start and end dates for fish {.unnumbered}

### Recruitment start and end dates for fish {.unnumbered}

### Spawning and recruitment start and end dates for benthos guilds {.unnumbered}

### Extra-domain stock biomass of migratory, and the proportion invading the domain each year. Start and end dates for the annual invasion, and start and end dates for the emigration. (see description below). {.unnumbered}

Data on the ‚Äòglobal‚Äô stock of northeast Atlantic mackerel and Blue whiting (wet biomass) are available from stock assessments [@ices2020], and converted to molar nitrogen mass using appropriate conversion ratios [@pedersen2021].
The proportion of the migrating stock entering the Norwegian Sea [@nottestad2016; @ekerhovd2010], and the timing of the inward and outward migrations [@iversen2002; @payne2012] are estimated from the literature.
A residual proportion of the peak abundance in the North Sea remaining as residents (if any) is estimated from summer trawl survey data.
The model setup code calculates the parameters which are needed in the ecology model.These are the only fixed (i.e. non-fitted) ecology model parameters which are period-specific.

```{r migrant_cap}

tab_migrant_cap <- table_nums(name = "tab_migrant", 
    caption = "Biological event timing parameters, constant across the 2011-2070 time period. The data are processed in the model setup to calculate the immigration flux parameters needed in the ecology model.")
```

`r table_nums("tab_migrant")`

```{r tab_migrant, fig.cap = tab_migrant_cap}

data_frame(Parameter = model[["data"]][["biological.events"]][["Description"]] %>% 
                        str_replace_all("_", " "),
           Value = model[["data"]][["biological.events"]][["Value"]]) %>% 
  .[1:13,] %>% 
  gt()

```

\newpage

`r table_nums("tab_migrant", display = "cite")` Continued.

```{r tab_migrantb}

data_frame(Parameter = model[["data"]][["biological.events"]][["Description"]] %>% 
                        str_replace_all("_", " "),
           Value = model[["data"]][["biological.events"]][["Value"]]) %>% 
  .[14:26,] %>% 
  gt()
```

# Ecological drivers {.unnumbered}

Monthly resolution time-varying physical and chemical driving parameters for the model were derived from a variety of sources:

-   Temperature, vertical mixing coefficients, volume fluxes, and boundary nutrient, detritus and phytoplankton concentrations from outputs of an ensemble of NEMO-ERSEM coupled hydro-geochemical model runs with a 2015 historical/future split CITE YURI XXX.
-   Surface shortwave radiation from CMIP6 used to force the NEMO-ERSEM coupled hydro-geochemical runs mentioned above.
-   Freshwater volume outflows from CMIP6 used to force the NEMO-ERSEM coupled hydro-geochemical runs mentioned above.
-   River nitrate and ammonia concentrations taken from the IMAGE model to force the NEMO-ERSEM coupled hydro-geochemical runs mentioned above.
-   Atmospheric deposition of nitrate and ammonia from ISIMIP3a ([Inter-Sectoral Impact Model Intercomparison Project](https://data.isimip.org/10.48364/ISIMIP.759077.2); [@yang22]) with SSP projects from ISIMIP3b used to force the NEMO-ERSEM coupled hydro-geochemical runs mentioned above.
-   Remote sensing data products on Suspended Particulate Matter (Globcolour L3b; <ftp://ftp.hermes.acri.fr/GLOB/merged/month/>).
-   Habitat disturbance due to tidal currents and waves from **TBD** [@laverick2022].
-   Wave height, period, and direction from the ERA-5 reanalysis monthly means accessed through [CDS](https://cds.climate.copernicus.eu/cdsapp#!/dataset/10.24381/cds.f17050d7?tab=overview) for 1980-2021 [@Hersbach19].

Details of how these data were processed are given below, supported by the [nemomedusR](https://jack-h-laverick.github.io/nemoRsem/) and [MiMeMo.tools](https://jack-h-laverick.github.io/MiMeMo.tools/) packages.

### NEMO-ERSEM ensemble: {.unnumbered}

Four different NEMO-ERSEM runs were used to parameterise different versions of the Norwegian Sea implementation of StrathE2E.
These four runs are a 2x2 factorial cross of two future projected scenarios (SSP126 and SSP370) with a historical hindcast from 2015, and forcing by two atmospheric models (CNRM and GFDL).
In the following sections model output was processed for a 2010-2019 baseline period, and then decadal projections from 2020-2029 until 2060-2069.

### Vertical mixing coefficients between the model layers: {.unnumbered}

Vertical diffusivity from the NEMO-ERSEM coupled hydro-geochemical model output was interpolated for each grid cell at the `r SDepth`m boundary depth between the shallow and deep layers of the offshore zone, and the `r DDepth`m boundary at the deep sea overhang.
These values were summarised as monthly averages into period-specific climatological annual cycles of data for decadal periods for all combinations of SSPs and forcings.

### Monthly averaged temperatures for each water column layer: {.unnumbered}

Derived by monthly averaging values at grid points within the inshore and vertical layers of the offshore zones from the NEMO-ERSEM coupled hydro-geochemical model output, weighted by grid point volumes.
Values were summarised into period-specific climatological annual cycles of data.

### Monthly averaged suspended particulate matter (SPM) concentrations (mg.m^-3^) in the shallow zone and the deep zone upper layer: {.unnumbered}

Monthly averaged values of inorganic suspended particulate matter in sea water are available from the Globcolour project, starting from September 1997.
These data are derived from satellite observations using the algorithm of Gohin [-@gohin11].
Data were downloaded from the ftp server (<ftp://ftp.hermes.acri.fr/GLOB/merged/month/>).
We summarised these values as zonal statistics for the model domain to acquire a climatological annual cycle of data for the 2010-2019 simulation period only.

### Monthly average light attenuation coefficients for the inshore and offshore surface layers: {.unnumbered}

Light attenuation in open water was parameterised from a linear relationship between the light attenuation coefficient and suspended particulate matter concentration (SPM) (Devlin et al., 2008).

### Monthly averaged daily integrated irradiance at the sea surface (E.m^-2^.d^-1^): {.unnumbered}

Derived from HadGEM2-ES model output [@jones11] which forces the NEMO-ERSEM model run used throughout our implementation.
Monthly mean values were summarised into climatological annual cycles of data for decadal periods and NEMO-ERSEM ensembles.

### Monthly averaged daily atmospheric deposition rates of oxidised and reduced nitrogen onto the sea surface in the shallow and deep zones (mMN.m^-2^.d^-1^): {.unnumbered}

Sourced from the "histsoc" files for a 1901 - 2021 hindcast as monthly averages [@yang22], available from [CDS](https://cds.climate.copernicus.eu/cdsapp#!/dataset/10.24381/cds.f17050d7?tab=overview).
Monthly values were summarised into climatological annual cycles of monthly oxidised and reduced nitrogen deposition rates extracted for 2010-2019.
ISIMIPb Projections for SSP126 and SSP370 were processed in the same way for decadal periods up to and including the 2060s.

### Monthly averaged, freshwater river inflow rates (expressed as a daily proportion of the receiving layer volume), and concentrations of oxidised and reduced dissolved inorganic nitrogen in the inflowing river waters (mMN.m^-3^): {.unnumbered}

Freshwater inflow derived from HadGEM2-ES model output [@jones11] which forces the NEMO-MEDUSA model run used throughout our implementation.
Monthly values were summaries into a climatological annual cycle of data for both the 2010-2019 and 2040-2049 periods.

### Volume fluxes into the model domain across open sea boundaries, and from the upper layer of the offshore/deep zone into the inshore/shallow zone, expressed as proportions of the receiving layer volume per day: {.unnumbered}

Monthly averaged daily inflow and outflow volume fluxes derived by integrating daily mean velocities directed perpendicular to transects along the model domain boundary at grid points in each depth layer along transects through outputs from the NEMO-ERSEM coupled hydro-geochemical model output.
Monthly averaged daily inflow volume fluxes then divided by the volume of the receiving layer in the model domain to estimate a daily flushing rate.

### Mean concentrations of nitrate, ammonia, phytoplankton and suspended detritus (mMN.m^-3^), in adjacent ocean waters inflowing to the offshore/deep zone upper layer, adjacent ocean waters inflowing to the offshore/deep zone lower layer, and adjacent shelf waters inflowing to the inshore/shallow zone: {.unnumbered}

NEMO-ERSEM outputs included nitrate, ammonia, phytoplankton and suspended detritus.
We calculated the depth-averaged concentrations for pixels within the shallow and deep layers of StrathE2E.
We then sampled the pixels using the same transects around the model domain as for sampling volume fluxes.
Only transects where water flowed into the model domain were sampled, and the average concentration of inflowing waters for target variables was calculated weighting by the flow rate across a transect and the cross-sectional area represented by a transect (average depth and length).
Concentrations were then averaged into climatological annual cycles.
The flow weighted averaging of concnetrations was calculated on the 5-day NEMO-ERSEM timestep, before averaging to a monthly climatology of concentrations.

# Fishing fleet {.unnumbered}

## Background {.unnumbered}

The key configuration data for the fishing fleet model are the definitions of the gears in terms of their power with respect to each of the harvestable resource guilds, discarding rates, processing-at-sea rates, and their seabed abrasion rates.
These can be regarded as static parameters for each gear.

An additional class of static parameters is the scaling coefficients between effort (activity x power) and the harvest ratio generated on each model resource guild.
These parameters have to be derived by fitting.

Finally, there are parameters which we can consider as driving data since they would be expected to vary with time.
These are the activity rates of each gear, and their spatial distributions across the habitat types.

Our principal data sources for the fishing catch data were obtained from Seas Around Us (SAU) [@pauly20]. 
Seas Around Us data that matches closest to the model implementation domain is provided under the EEZ label "South Africa Atlantic and Cape". The area this fisheries data covers encompasses the intersection between the South Africa EEZ and the FAO fishing zone 47. This area is larger than the model implementation domain.
To obtain estimated catch for the model domain area, we calculated the proportion of spatial effort occurring within the SAU South Africa Atlantic and Cape region that occurs within the model domain. This gives us a unique scaling for each gear type that is then applied to all raw catch values from SAU. For all gear types these proportion scales are calculated from SANBI data layers, as used to calculate the spatial distribution of fishing activity across the habitat types (WCRL landings are assumed to be obtained from within the model domain as this is the dominant habitat/range of the species [@dffe23]).

## Regional activity rates, of each gear type {.unnumbered}
Annual regional activity rates for each gear type were determined primarily through literature, with the Global Fishing Watch database being used in the absence of literature estimates for the purse-seine fleet. Activity levels in seconds are collated for each gear type and converted to s/m^2/d by dividing values by the model domain area and 360 (the number of days per year represented in StrathE2E).
The details of activity estimation for each gear type are as follows:

### Midwater trawl
Midwater trawl effort is estimated from [-@reed17]. Values are provided for the number of trawls occurring annually and the proportion and duration of trawls occurring at day and night. These values are then converted to seconds and scaled by the proportion of total midwater trawl activity occurring within the domain (using spatial data provided by [@-sanbi18]).

### Nets including small scale
Net effort is estimated for beach-seine and gillnet gears and combined, small scale net activity data is not available. Activity values for the Western Cape are obtained from [@-hutchings10] as gillnet fishing days and beach-seine hauls per year. We assume that 1 beach seine haul is performed per day to estimate the number of beach-seine fishing days. We assume that fishers fish for half of these days (12h per day) and convert the activity to seconds.

### Pole and line
Pole and line activity data is obtained from [@-west24] as the number of vessels with active rights in South Africa for the 2019-2023 period. The average duration of a fishing trip by this fleet is 14 days [@west24]. We assume that boats spend 2 weeks at sea and then 2 weeks on land, resulting in 182 days of fishing per year. We assume that boats spend 12h per day fishing and convert the activity to seconds. The activity is then scaled by the proportion of 'tuna pole' activity occurring within the domain (spatial data provided by [@sanbi18]).

### Squid jig
Squid jig activity is obtained from [@cochrane14] as the total number of man-hours occurring in South Africa per year. We convert this to vessel-hours assuming that the average number of crew per vessel is 21 [@cochrane14] and convert vessel hours to seconds. The activity is then scaled by the proportion of squid jig activity occurring within the domain (spatial data provided by [@sanbi18]).

### Longline
Longline activity levels are estimated separately for pelagic and demersal longline fleets and then combined.

Pelagic longline activity values are obtained from [@parker21] as the number of boats in South Africa over the 2010-2019 period. The average trip duration is 14 days, we assume that boats spend 2 weeks at sea and 2 weeks on land, resulting in 182 fishing days per year. We assume that 12h of fishing per day is occurring on pelagic longline vessels. This activity is then converted to seconds and scaled by the proportion of pelagic longline activity occurring within the domain (spatial data provided by [@sanbi18]).

Demersal longline activity values are obtained from [@bergh22] as the number of sets used in the fleet annually. We assume the average number of hooks per set is 14,000 [@nyengera19] and the number of hooks used per day is 14,995, calculating the total number of demersal longline fishing days per year in the fleet. Demersal longline setting generally begins at 2am with hauling occurring until 8pm (18h fishing time per day) [@nyengera19]. The activity is then converted to seconds and scaled by the proportion of activity occurring within the domain (spatial data for 'hake longline' provided by [@sanbi18]).

### Purse seine
Due to a lack of literature sources for purse seine activity levels Global Fishing Watch data is used to estimate annual activity in the domain in hours.

### Demersal trawl
The number of trawling hours by the demersal trawl fleet in South Africa are obtained from [@barrybaker07]. Values available cover the 1996-2004 period but values from 1996-1999 are substantially higher than values from 2000-2004, thus we take values from 2000-2004. The mean annual activity level is then converted to seconds and scaled by the proportion of demersal inshore and offshore trawling occurring within the domain (spatial data provided by [@-sanbi18]).

### West Coast Rock Lobster Traps
The number of commercial (offshore) trapping trips conducted by the West Coast Rock Lobster trap fishery (2016-2019) were obtained from [@eggers21]. We assume the trips last around 2 days [@safe20] and traps are in the water for 75% of the trip duration (18h/day). The activity level is then converted to seconds. We assume that the West Coast Rock Lobster trapping fleet operates exclusively within the model implementation domain.

### Recreational fishing gear
The number of recreational fishers in the Western Cape region is estimated from [@pots21], with fishing occuring an average of 48 days per year. We assume that recreational fishing trips last 5h and convert the activity to seconds.

### Small scale lines
The number of small scale fishers operating in South Africa is obtained from [dffe23], with 85% of fishers targetting linefish (small scale lines). We assume that small scale line fishers fish 5 days per week, removing a month of the year due to inclement conditions (230 days/year). We assume that fishers spend 12h per day fishing. Activity is then converted to seconds and scaled by the proportion of linefishing effort occurring within the model domain area.

### Subsistence fishing gear
The number of subsistence fishers fishing in the model domain is estimated in [@clark02]. Subsistence fishing is estimated to occur 219 days per year [@ermgassen20]. Fisher testimony conveys fishing starting from 4am [@ntimbane], we assume that the average fishing duration is 12h/day. Activity is then converted to seconds.

- `West Coast Rock Lobster traps` : Annual activity data (number of trips) is available for the 2016-2019 period from [@Eggers21]. Only the offshore sector trips are included in calculations as this geartype contains the commercial offshore trapping fleet. Other gears, including small scale and subsistence are assumed to capture the nearshore West Coast Rock Lobster fishery, which is distinct from the offshore fishery [@dffe23].

## Spatial proportional distribution of activity by each gear {.unnumbered}
For all fishing fleets, the proportion of fishing gear activity over the habitat domain is calculated as the proportion of the target gear's activity that occurs within each habitat/shore type. E.g. if 1h of trawling occurs in the inshore rocky habitat type and the total amount of activity occurring in the domain is 10h then the inshore rocky habitat type will have a proportion of 0.1. This produces a gear-type x habitat matrix, with rows for each gear-type summing to 1. Proportion calculations were primarily performed using spatial activity data in raster formats and habitat domain data in vector formats.

Where data are obtained from SANBI, the data have been created to contribute to cumulative marine pressure mapping for the 2018 National Biodiversity Assessment by Stephen Holness [@holness18]. These data were created from various sources of spatial fishing activity and catch, and have been manipulated to remove outlier values (e.g. removing values above the 90% percentile). As some layers are derived from spatial catch density, these layers may not fully represent the extent of fleet activity. These layers are not considered to be accurrate, but rather a best guess at the distribution of fishing activity across South African waters. It is acknowledged that mapping of small scale and subsistence fishing is preliminary and, "according to many stakeholders incomplete" (pers comms [@-fairweather25]). Data were obtained from [@sanbi18] and [@holness18].

The sources and processing for each gear type are described below:
- `midwater trawl` : Midwater trawl spatial pressure data were obtained from SANBI [@sanbi18]. These data are derived from values of hours of trawling.

- `nets including small scale` : Gillnet and Beach-seine spatial pressure data from SANBI [@sanbi18] were combined. These data are derived from numbers of fishing rights allocated / km^2.

- `pole and line` : Pole and line spatial pressure data (labelled 'Tuna Pole') were obtained from SANBI [@sanbi18]. These data are derived from catch in kg / km^2.

- `squid jig` : Squid jig spatial pressure data were obtained from SANBI [@sanbi18]. These data are derived from values of catch in kg / km^2.

- `longline` :  Pelagic and demersal (labelled 'Hake Longline') longline data were obtained from SANBI [@sanbi18] and combined additively. Demersal longline data are derived from catch in kg / km^2 and pelagic longline data are derived from effort in hooks / km^2.

- `purse seine` : Purse seine data (labelled 'Small Pelagic Fishery') were obtained from SANBI [@sanbi18]. It was confirmed that the spatial distribution of SANBI small pelagic fishery data and Global Fishing Watch data [@gfw25] (used for annual activity estimates) matched closely. SANBI spatial data are derived from catch in kg / km^2.

- `demersal trawl` : Demersal (inshore and offshore) trawl data were obtained from SANBI [@sanbi18]. Data are derived from effort in hours of trawling.

- `West Coast Rock Lobster traps` : Commercial West Coast Rock Lobster traps are used in rocky habitats at depths greater than 100m [@dffe23]. We distribute West Coast Rock Lobster trap activity uniformly over rocky habitat regions at depths > 100m before calculating the proportion of this activity between inshore and offshore rocky habitat zones.

- `recreational fishing gear` : Linefishery and shore-based recreational fishing gear spatial pressure data from SANBI [@sanbi18] were combined. The linefishery data layer from SANBI approximately represents recreational boat-based fishing activity [@sanbi18]. Linefish spatial pressure data were derived from values in catch kg / km^2, while shore-based recreational fishing spatial pressure data were derived from values in density of fishers / km^2.

- `small scale lines` : The 'Linefishery' spatial activity data layer from SANBI [@sanbi18] was assumed to represent the spatial effort distribution for the small scale line fleet. This data layer was derived from catch values in kg / km^2.

- `subsistence fishing gear` : Subsistence fishing gear data (labelled 'Subsistence Harvest') were obtained from SANBI [@sanbi18]. This data layer is derived from values of fishermen / km^2.

## Catching power and discard rates of each resource guild by each gear: {.unnumbered}

Due to a lack of publically available official fisheries data and time constraints, Seas Around Us catch data are used to calculate fishing fleet input data for the implementation.

Species in Seas Around Us data that were previously not accounted for in StrathE2E guilds were allocated to guilds based on diet composition and movement information from FishBase. Yellowtail Kingfish (*Seriola lalandi*), previously allocated to planktivorous fish, was allocated to Demersal fish due to it's predatory ecology and classification in EwE from [-@shannon20].

Gear types in Seas Around Us data were matched to the chosen fleets for the StrathE2E model implementation as follows:

- `midwater trawl` => 'pelagic trawl'
- `nets including small scale` => 'bagnets', 'cast nets', 'small scale gillnets', 'small scale encircling nets', 'small scale seine nets', 'small scale other nets', 'gillnets'
- `pole and line` => 'pole and line'
- `longline` => 'longline'
- `demersal trawl` => 'bottom trawl'
- `recreational fishing gear` => 'recreational fishing gear'
- `small scale lines` => 'small scale lines', 'hand lines'
- `subsistence fishing gear` => 'subsistence fishing gear'
- `squid jig` => The squid jig fishing fleet was added by taking squid catch from the 'small scale lines' gear type and renaming the gear to 'squid jig'. It is assumed that these catches were obtained by fishers using squid jigs and were collated with other small scale lines fishing methods by Seas Around Us, and should be separated into a separate gear type as squid jigs have high species selectivity compared to other small scale lines using hooks.
- `West Coast Rock Lobster traps` => West Coast Rock Lobsters (*Jasus lalandii*) are primarily caught by 'unknown class' in Seas Around Us data. It was assumed that this proportion of the *J lalandii* catch was taken by commercial fishers using traps as *J lalandii* are also caught, in lower levels, by the nets gear type, which likely represents the nearshore netfishery for West Coast Rock Lobster. These 'unknown class' catch for *J lalandii* were relabeled as `West Coast Rock Lobster traps` gear type. There is low evidence for bycatch in this fishery [@dffe23], so only *J lalandii* catch were attributed to this gear type.

### Bycatch of birds
#### Longlines
The numbers of birds caught and examined at port from the pelagic longline fishery [@rollinson17] and demersal longline fishery [@peterson09] were used to calculate bycatch weights for birds by the longline fishing gear type. In the longline fishery in South Africa, permits state that any deceased birds must be returned to port for examination, these values were therefore attributed as landings. [-@peterson09] suggest that 40% of birds caught in the longline fishery are not returned to port due to operational reasons. Therefore 40% of the total seabird-longline bycatch weight was attributed to seabird-longline discards.

#### Demersal trawl
[-@watkins08] present numbers of birds killed in the demersal trawl fishery. It is assumed that these birds are most often killed during waste dumping and are not returned to port, and therefore have been attributed to the fishery as discards [@watkins08].

### Final processing {.unnumbered}

1.  Landings and discards are scaled by the proportion of gear type activity occuring within the SAU region that occurs within the model domain.

2. Landings and discards for each guild, gear type and year are summed and then averaged across 2010-2019 to obtain annual average catch in tonnes.

3. Additional bycatch of birds from literature sources are added to guild * gear type data.

4. Discard rates (only present for demersal fish x demersal trawl) are calculated as the proportion of annual average discards from annual average catch.

5. Units for catch are converted to g/m^2/day by dividing by 1,000,000, the domain area and 360 (number of days represented in StrathE2E).

6. Power is calculated as catch divided by the activity of each gear type (in s/m^2/day).

6. Guild values are converted to nitrogen units per gram of wet weight.

# Target data {.unnumbered}
Target data is used for optimisation in the fitting of parameters.

## Biological target data
Biological target data for the region such as production measures, diet composition and Production/Biomass ratios were provided by Lynne Shannon and Kelly Ortega-Cisneros from [@shannon20]. These data are derived from an Ecopath with Ecosim model of the Southern Benguela region.

## Physical target data
### Seasonal nutrient concentrations
Season allocations: seasonal nutrient concentrations were calculated using Nov-Feb as 'winter' months and May-Aug as 'summer' months to match the Northern Hemisphere development of StrathE2E, despite South Africa's austral seasons.

Seasonal averaged nitrate concentrations were calculated from World Ocean Atlas 2023 data. Monthly data were obtained from [World Ocean Atlas](https://www.ncei.noaa.gov/products/world-ocean-atlas). For the shallow water volume all 1$\degree$ cells touching the domain containing valid data were extracted from depths between 0 and `r SDepth`.
For the deep water volume all cells touching the offshore domain were extracted from depths between `r SDepth` and `r DDepth`. The volumes of the water layers were calculated as the polygon area multiplied by the average depth of the area from mean sea level.

### Sediment chemistry

# End {.unnumbered}

## Acknowledgements {.unnumbered}

Financial support for the development of the Southern Benguela implementation of StrathE2E2 came from the European Union's Horizon 2020 research and innovation programme (Mission Atlantic - No. ).
We are grateful to:

## References {.unnumbered}